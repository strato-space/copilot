# Orphan voice messages export

- Export root: `/home/strato-space/copilot/ontology/orphan`
- Collection folder: `/home/strato-space/copilot/ontology/orphan/automation_voice_bot_messages`
- Exported messages: `8`
- Format: one Mongo Extended JSON document per file (`<message_id>.json`).

## Status update (2026-02-28)

- This README contains historical analysis for the original `8` orphan messages.
- Remediation was partially applied in MongoDB:
  - Stub session created: `6870c15d8b055b47afb956af`.
  - Stub attributes set for runtime visibility:
    - `project_id`: `68be735c0994efca4d903c91` (PMO)
    - `created_at`: `2025-07-11 07:56:23.959000`
    - `runtime_tag`: `prod-p2`
    - `access_level`: `public`
  - Messages now linked to this stub session: `2`
    - `6870c3a79126f622565e7a72`
    - `6870cff19126f622565e7a73`
- Low-value orphan messages deleted from `automation_voice_bot_messages`: `6`
  - `686686038788dbe6eb777f5f`
  - `6870e01de80fdd083dd47305`
  - `6870e30f1ec509ea7c97365b`
  - `6870e34a1ec509ea7c97365c`
  - `68739c4d597bcc5c117cfdba`
  - `6877d81836526dd9ae421e34`
- Current state after cleanup:
  - `orphan_count_after = 0` (by rule: `message.session_id` absent in `automation_voice_bot_sessions._id`).
- Related bug registered for UI/API diagnostic mismatch:
  - `copilot-k8v3` (`404 not found` incorrectly shown as `prod/dev mismatch` in SessionPage).

## What is considered orphan

- Message from `automation_voice_bot_messages` is orphan if its `session_id` is absent in `automation_voice_bot_sessions._id`.

## Key nuances found

- Earliest session in `automation_voice_bot_sessions`: `2025-07-13 13:45:22.527000`.
- For 7/8 orphan messages there are no session candidates even in 96h lookback window (historical coverage gap).
- Only message `6877d81836526dd9ae421e34` has 96h candidates (`27`, including `5` deleted).
- In all 8 messages, no extra references to missing `session_id` were found outside `session_*` fields.
- Dominant duplicate intents:
  - UI request: show last question in dialog immediately (4 messages).
  - Request for quick instruction / how to test (2 messages).
  - One long org+AI discussion message, one thank-you message.

## Message list

| message_id | created_at | missing_session_id | chat_id | cand_24h | cand_96h | deleted_in_96h | hidden_refs_outside_session_fields |
|---|---|---|---:|---:|---:|---:|---:|
| `686686038788dbe6eb777f5f` | `2025-07-03 13:30:43.813000` | `686686038788dbe6eb777f5e` | 214255344 | 0 | 0 | 0 | 0 |
| `6870c3a79126f622565e7a72` | `2025-07-11 07:56:23.959000` | `6870c15d8b055b47afb956af` | 214255344 | 0 | 0 | 0 | 0 |
| `6870cff19126f622565e7a73` | `2025-07-11 08:48:49.831000` | `6870c15d8b055b47afb956af` | 214255344 | 0 | 0 | 0 | 0 |
| `6870e01de80fdd083dd47305` | `2025-07-11 09:57:49.092000` | `6870e00de80fdd083dd47302` | 214255344 | 0 | 0 | 0 | 0 |
| `6870e30f1ec509ea7c97365b` | `2025-07-11 10:10:23.601000` | `6870e3071ec509ea7c97365a` | 214255344 | 0 | 0 | 0 | 0 |
| `6870e34a1ec509ea7c97365c` | `2025-07-11 10:11:22.006000` | `6870e3071ec509ea7c97365a` | 214255344 | 0 | 0 | 0 | 0 |
| `68739c4d597bcc5c117cfdba` | `2025-07-13 11:45:17.709000` | `6870e3771ec509ea7c97365d` | 214255344 | 0 | 0 | 0 | 0 |
| `6877d81836526dd9ae421e34` | `2025-07-16 16:49:28.298000` | `6877d7e336526dd9ae421e2e` | 214255344 | 7 | 27 | 5 | 0 |

## Semantic summary (for quick review)

- UI immediate-last-question intent:
  - `6870cff19126f622565e7a73`
  - `6870e01de80fdd083dd47305`
  - `6870e34a1ec509ea7c97365c`
  - `6877d81836526dd9ae421e34`
- Instruction/how-to-test intent:
  - `6870e30f1ec509ea7c97365b`
  - `68739c4d597bcc5c117cfdba`
- Org/AI/design/updates mixed discussion:
  - `6870c3a79126f622565e7a72`
- Thank-you message:
  - `686686038788dbe6eb777f5f`

## Подробное саммари по каждой проблемной сессии (на основе orphan-сообщений)

Ниже под «сессией» понимается `missing_session_id` из orphan-сообщения. Самих документов этих сессий в `automation_voice_bot_sessions` нет, поэтому описание восстановлено по содержимому привязанных сообщений.

### 1) Сессия `686686038788dbe6eb777f5e`

- Сообщение: `686686038788dbe6eb777f5f`
- Дата сообщения: `2025-07-03 13:30:43.813`
- Суть: короткая вежливая реплика благодарности: «Благодарствую, Антон Владимирович».
- Контекст по смыслу: завершение контакта/обратной связи без задач, требований или технических деталей.
- Операционный вывод: информационная ценность как бизнес-контента низкая; это не рабочий таск и не постановка задачи.

### 2) Сессия `6870c15d8b055b47afb956af`

- Сообщения:
  - `6870c3a79126f622565e7a72` (`2025-07-11 07:56:23.959`)
  - `6870cff19126f622565e7a73` (`2025-07-11 08:48:49.831`)
- Содержательная картина:
  - Организационный блок: обсуждение переноса встречи (на следующий слот/неделю), фиксация ограничений по участникам (упоминание болезни коллеги).
  - Продуктово-технический блок: поиск более качественных AI-инструментов для генерации паков изображений; сравнение GPT/Recraft; акцент на проблеме консистентности результата и необходимости формализовать стилистику/атрибуты.
  - Статусный блок по разработке: апдейты по дашбордам «Урал», виджетам, правкам, разделению большого файла, настройке флагов и согласованности изменений.
  - UX-требование (во втором сообщении): «последний вопрос в диалоге должен отображаться сразу».
- Контекст по смыслу: смешанная рабочая сессия (операционка + AI-процессы + требования к интерфейсу).
- Операционный вывод: высокополезная сессия для продуктовых инсайтов, так как содержит и постановку проблемы, и прикладные технические замечания.

### 3) Сессия `6870e00de80fdd083dd47302`

- Сообщение: `6870e01de80fdd083dd47305`
- Дата сообщения: `2025-07-11 09:57:49.092`
- Суть: повторяющееся UX-требование — отображать последний вопрос в диалоге без задержки.
- Контекст по смыслу: фокус только на пользовательском сценарии отображения последнего шага диалога; без дополнительных деталей архитектуры.
- Операционный вывод: это явный кандидат на формализацию в продуктовый requirement/acceptance criteria для UI/чатового интерфейса.

### 4) Сессия `6870e3071ec509ea7c97365a`

- Сообщения:
  - `6870e30f1ec509ea7c97365b` (`2025-07-11 10:10:23.601`)
  - `6870e34a1ec509ea7c97365c` (`2025-07-11 10:11:22.006`)
- Содержательная картина:
  - Сообщение 1: запрос «дайте инструкцию, как потыкать», выражение готовности протестировать и живого интереса.
  - Сообщение 2: снова UX-требование про немедленное отображение последнего вопроса в диалоге.
- Контекст по смыслу: короткая прагматичная сессия «как быстро проверить» + зафиксированный pain point интерфейса.
- Операционный вывод: сочетание «нужен быстрый runbook» и «конкретный UI-баг/долг»; полезно для раздела onboarding/test checklist.

### 5) Сессия `6870e3771ec509ea7c97365d`

- Сообщение: `68739c4d597bcc5c117cfdba`
- Дата сообщения: `2025-07-13 11:45:17.709`
- Суть: повтор запроса на инструкцию для практического теста («как потыкать»), подтверждение интереса «мне очень любопытно».
- Контекст по смыслу: пользователь ожидает простой и понятный сценарий самостоятельной проверки функционала.
- Операционный вывод: сигнал о недостатке явной инструкции в текущем процессе (UX документации/внутренней помощи).

### 6) Сессия `6877d7e336526dd9ae421e2e`

- Сообщение: `6877d81836526dd9ae421e34`
- Дата сообщения: `2025-07-16 16:49:28.298`
- Суть: снова тот же UX-запрос — последний вопрос в диалоге должен отображаться сразу.
- Контекст по смыслу: устойчивый повтор одного и того же требования спустя несколько дней, что обычно указывает на незакрытую пользовательскую боль.
- Доп. аналитика по кандидатам:
  - В окне 96 часов найдены кандидатные сессии, но у них другой `chat_id` и низкий семантический score (низкая уверенность привязки).
  - Есть и удалённые кандидаты в 96h, но качество матчинга также низкое.
- Операционный вывод: вероятнее всего это отдельная потерянная сессия, а не сообщение, которое надёжно можно «перекинуть» в существующую.

## Сводка по повторяемым темам

- Кластер A: «Показывать последний вопрос в диалоге сразу» — 4 сообщения (`6870cff19126f622565e7a73`, `6870e01de80fdd083dd47305`, `6870e34a1ec509ea7c97365c`, `6877d81836526dd9ae421e34`).
- Кластер B: «Нужна простая инструкция, как быстро протестировать» — 2 сообщения (`6870e30f1ec509ea7c97365b`, `68739c4d597bcc5c117cfdba`).
- Кластер C: «Орг + AI + статус разработки» — 1 сообщение (`6870c3a79126f622565e7a72`).
- Кластер D: «Благодарность/закрытие контакта» — 1 сообщение (`686686038788dbe6eb777f5f`).

## Практический вывод для последующих действий

- При удалении orphan-сообщений стоит отдельно зафиксировать дубликатные продуктовые сигналы (UI last-question + test instruction), чтобы не потерять требования.
- Если цель — очистка данных без потери знания, можно предварительно вынести кластеры A/B в task tracker как отдельные артефакты требований.
